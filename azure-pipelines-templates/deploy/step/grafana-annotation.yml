parameters:
  dashboardUID: ''
  panelId: 0
  tags: []  # Expecting an array
  text: ''
  BearerToken: ''
  IsMultiRepoCheckout: false

steps:
- checkout: self
- task: PowerShell@2
  displayName: "Create Grafana Annotation - ${{ parameters.dashboardUID }}"
  inputs:
    targetType: 'filePath'
    ${{ if eq(parameters.IsMultiRepoCheckout, false) }}:
      filePath: Infrastructure-Scripts/New-GrafanaDashboardAnnotation.ps1
    ${{ if eq(parameters.IsMultiRepoCheckout, true) }}:
      filePath: das-platform-automation/Infrastructure-Scripts/New-GrafanaDashboardAnnotation.ps1
    arguments: |
      -dashboardUID ${{ parameters.dashboardUID }} `
      -panelId ${{ parameters.panelId }} `
      -tags @(${{ format('{0}', join(',', parameters.tags)) }}) `  # Use 'format' to handle array as a comma-separated string
      -text "${{ parameters.text }}" `
      -token (ConvertTo-SecureString "${{ parameters.BearerToken }}" -AsPlainText -Force)
    pwsh: true
