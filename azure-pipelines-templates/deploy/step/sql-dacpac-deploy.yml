
parameters:
- name: Environment
  type: string
  values:
  - AT
  - TEST
  - TEST2
  - PP
  - PROD
  - MO
AzureSubscription:
ServerName:
DatabaseName:
SqlUsername:
SqlPassword:
DacpacFile:
pool:
AdditionalArguments:

jobs:
- job: waitForValidation
  pool: server
  timeoutInMinutes: 5 
  steps:
  - task: ManualValidation@0
    condition: and(eq(${{ parameters.Environment }}, AT), eq(${{ parameters.AdditionalArguments }}, true))
    timeoutInMinutes: 5 
    inputs:
      instructions: 'Please validate the build configuration and resume'
      onTimeout: 'reject'

- job: run sql dacpac
  pool: ${{ parameters.pool }}
  steps:
  - task: SqlAzureDacpacDeployment@1
    displayName: Execute Azure SQL DacpacTask
    inputs:
      AzureSubscription: ${{ parameters.AzureSubscription }}
      ServerName: ${{ parameters.ServerName }}
      DatabaseName: ${{ parameters.DatabaseName }}
      SqlUsername: ${{ parameters.SqlUsername }}
      SqlPassword: ${{ parameters.SqlPassword }}
      DacpacFile: ${{ parameters.DacpacFile }}
      ${{ if eq(parameters.AdditionalArguments, true) }}:
        AdditionalArguments: /p:BlockOnPossibleDataLoss=false