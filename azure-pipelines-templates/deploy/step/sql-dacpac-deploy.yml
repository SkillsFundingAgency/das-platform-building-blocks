parameters:
- name: AzureSubscription
- name: DacpacFile
##TO DO: remove?
- name: Environment
  type: string
  values:
  - AT
  - TEST
  - TEST2
  - PP
  - PROD
  - MO
  - DEMO
- name: OverrideBlockOnPossibleDataLoss
  type: boolean
- name: ServerName
- name: SqlUsername
- name: SqlPassword

steps:
- task: PowerShell@2
  displayName: Check for BlockOnPossibleDataLoss override
  inputs:
    filePath: das-platform-automation/Infrastructure-Scripts/Test-SqlDacpacDeployment.ps1
    arguments: -Environment ${{ parameters.Environment }} -OverrideBlockOnPossibleDataLoss ${{ parameters.OverrideBlockOnPossibleDataLoss }} -Verbose
- task: SqlAzureDacpacDeployment@1
  displayName: Execute Azure SQL DacpacTask
  inputs:
    AzureSubscription: ${{ parameters.AzureSubscription }}
    ServerName: ${{ parameters.ServerName }}
    DatabaseName: $(DatabaseNameVariable)
    SqlUsername: ${{ parameters.SqlUsername }}
    SqlPassword: ${{ parameters.SqlPassword }}
    DacpacFile: ${{ parameters.DacpacFile }}
    ${{ if eq(parameters.OverrideBlockOnPossibleDataLoss, true) }}:
      AdditionalArguments: /p:BlockOnPossibleDataLoss=false